<!DOCTYPE html>
<!--
Please don't be mean about my coding style. I just botched this tool because I needed it.
If you miss any functionality, feel free to submit a pull request.
//-->
<html>
<head>
    <title>Thread Split</title>
    <meta charset="UTF-8">
    <meta lang="de-De">
    <style>
        body {
            font-family: sans-serif;
        }
        h1 {
            text-align: center;
            font-size: 5em;
        }
        p {
            text-align: center;
            font-size: 2em;
        }
        .marked {
            background-color: #f2f8d2;
        }
        .container {
            width: 95%;
            height: 100%;
            justify-content: center;
            align-items: center;
        }
        label {
            padding: 12px 12px 12px 0;
            display: inline-block;
            font-size: 2em;
        }
        input[type=text], select, textarea, .number{
            width: 100%;
            padding: 12px;
            border: 1px solid #953aa1;
            border-radius: 4px;
            resize: vertical;
            font-size: 2em;
        }
        button {
            background-color: #410450;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: left;
            font-size: 2em;
        }
        .snippetOutput {
            width: 100%;
            height: 100%;
            padding: 12px;
            border: 1px solid #953aa1;
            border-radius: 4px;
            resize: vertical;
            font-size: 2em;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .outputcontainer {

            width: 100%;
        }
        
    </style>
</head>
<body>
    <h1>Thread Split
        <svg  height="0.7EM" viewBox="0 0 800 800" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
            <g>
                <path d="M57.347,604.807C66.617,620.54 72.668,647.709 85.681,667.34C107.695,700.55 138.358,724.489 156.214,724.489C163.587,724.489 169.547,718.516 169.547,711.156C169.547,703.797 163.587,697.824 156.214,697.824C144.275,697.824 119.751,677.781 102.688,649.104C91.889,630.954 87.708,605.384 80.047,591.852" style="fill-rule:nonzero;"/>
                <path d="M56.693,537.659C41.891,509.558 42.751,502.972 42.751,487.466C42.751,450.707 56.141,400 92.902,400C129.663,400 173.333,416.572 173.333,453.333C173.333,490.092 203.239,520 240,520C254.706,520 266.667,531.959 266.667,546.667L266.667,554.294L270.227,555.588C272.667,558.267 276.094,560.002 280,560.002C280.533,560.002 281,559.761 281.52,559.695L429.694,613.575L489.388,578.575L286.788,521.602C277.773,504.869 260.308,493.334 240.002,493.334C217.948,493.334 200.002,475.388 200.002,453.334C200.002,401.867 144.358,373.336 92.905,373.336C41.452,373.336 16.086,436.001 16.086,487.466C16.086,507.056 15.027,514.864 30.519,544.517" style="fill-rule:nonzero;"/>
                <path d="M266.667,176.014L266.667,269.147L386.214,206.227C401.32,208.28 416.814,209.88 432.481,211.041L432.881,211.8L266.667,299.28L266.667,356.133L523.347,212.759C544.653,211.986 565.906,210.4 586.573,207.986L320.786,356.453L393.986,374.747L720,189.72L720,176.014C760.6,158.641 786.667,135.414 786.667,106.667C786.667,37.386 635.533,0 493.333,0C351.133,0 200,37.386 200,106.667C200,135.414 226.067,158.641 266.667,176.014ZM493.333,26.667C645.959,26.667 760,68.894 760,106.667C760,134.934 696.08,165.708 599.92,179.387C599.241,179.494 598.534,179.573 597.853,179.667C590.639,180.667 583.253,181.587 575.694,182.387C573.427,182.628 571.108,182.814 568.814,183.028C562.547,183.628 556.241,184.214 549.761,184.681C545.12,185.002 540.387,185.202 535.667,185.455C531.2,185.681 526.8,185.987 522.241,186.148C512.694,186.481 503.055,186.669 493.334,186.669C483.614,186.669 473.975,186.483 464.428,186.148C459.869,185.989 455.469,185.681 451.002,185.455C446.281,185.202 441.548,185.002 436.908,184.681C430.428,184.214 424.12,183.628 417.855,183.028C415.561,182.814 413.241,182.628 410.975,182.387C403.416,181.587 396.028,180.667 388.802,179.667C388.122,179.573 387.428,179.494 386.761,179.4C290.587,165.706 226.667,134.933 226.667,106.667C226.667,68.894 340.706,26.667 493.333,26.667Z" style="fill-rule:nonzero;"/>
                <path d="M720,624.067L720,569.253L488.706,706.586C471.533,706.48 455.306,705.719 440.039,704.466L720,538.241L720,483.747L708.72,480.92L352.733,689.6C339.933,685.947 329.039,681.933 320.2,677.759L399.814,631.092L266.667,582.678L266.667,624.064C211.92,647.641 200,674.52 200,693.333C200,762.614 351.133,800 493.333,800C635.533,800 786.666,762.614 786.666,693.333C786.667,674.52 774.747,647.641 720,624.067ZM493.333,773.333C340.706,773.333 226.666,731.106 226.666,693.333C226.666,680.427 241.306,666.053 266.666,653.413C266.666,655.039 267.106,656.559 267.319,658.145C267.545,659.733 267.559,661.372 267.986,662.919C268.4,664.359 269.186,665.705 269.759,667.092C270.427,668.692 270.919,670.345 271.812,671.878C272.506,673.078 273.533,674.184 274.359,675.345C275.519,676.998 276.545,678.678 277.973,680.252C278.8,681.172 279.906,682.011 280.814,682.919C282.573,684.639 284.241,686.386 286.294,688.025C287.134,688.692 288.187,689.305 289.067,689.958C291.48,691.731 293.867,693.517 296.6,695.184C297.241,695.57 298.014,695.917 298.667,696.305C301.867,698.172 305.147,700.011 308.747,701.745C309.147,701.945 309.614,702.105 310.014,702.305C318.373,706.238 327.667,709.838 337.828,713.052C337.908,713.064 337.987,713.092 338.055,713.119C348.641,716.439 360.081,719.359 372.161,721.878C372.908,722.025 373.708,722.158 374.455,722.305C385.975,724.638 397.987,726.625 410.441,728.225C410.734,728.266 411.041,728.278 411.334,728.319C417.681,729.119 424.094,729.839 430.602,730.452C433.175,730.692 435.802,730.838 438.389,731.052C456.416,732.519 474.869,733.331 493.336,733.331C511.803,733.331 530.256,732.517 548.283,731.052C550.869,730.838 553.495,730.692 556.069,730.452C562.575,729.838 568.989,729.119 575.336,728.319C575.63,728.278 575.936,728.266 576.23,728.225C588.683,726.625 600.697,724.638 612.216,722.305C612.963,722.158 613.763,722.025 614.509,721.878C626.589,719.358 638.03,716.438 648.616,713.119C648.683,713.092 648.762,713.066 648.842,713.052C659.002,709.838 668.295,706.238 676.656,702.305C677.056,702.105 677.523,701.945 677.923,701.745C681.523,700.013 684.803,698.172 688.003,696.305C688.656,695.919 689.43,695.572 690.07,695.184C692.803,693.517 695.191,691.731 697.603,689.958C698.483,689.305 699.536,688.691 700.377,688.025C702.43,686.384 704.097,684.639 705.856,682.919C706.762,682.013 707.87,681.172 708.697,680.252C710.123,678.678 711.15,676.998 712.311,675.345C713.137,674.186 714.164,673.078 714.858,671.878C715.752,670.345 716.244,668.692 716.911,667.092C717.484,665.706 718.27,664.359 718.684,662.919C719.111,661.372 719.125,659.733 719.352,658.145C719.564,656.559 720.005,655.039 720.005,653.413C745.364,666.053 760.005,680.427 760.005,693.333C760,731.106 645.959,773.333 493.333,773.333Z" style="fill-rule:nonzero;"/>
                <path d="M493.333,160C552.973,160 613.333,141.68 613.333,106.667C613.333,71.653 552.973,53.334 493.333,53.334C433.692,53.334 373.333,71.655 373.333,106.667C373.333,141.68 433.694,160 493.333,160Z" style="fill-rule:nonzero;"/>
                <path d="M671.745,471.68L286.786,375.441L266.666,386.68L266.666,409.014L601.439,512.894L671.745,471.68Z" style="fill-rule:nonzero;"/>
                <path d="M720,381.394L633.853,434.727L720,456.259L720,381.394Z" style="fill-rule:nonzero;"/>
                <path d="M521.333,559.856L570.306,531.15L266.667,436.936L266.667,488.23L521.333,559.856Z" style="fill-rule:nonzero;"/>
                <path d="M720,298.217L536.853,410.47L597.773,425.697L720,350.031L720,298.217Z" style="fill-rule:nonzero;"/>
                <path d="M720,220.372L431.48,384.131L500.614,401.413L720,266.945L720,220.372Z" style="fill-rule:nonzero;"/>
            </g>
    </svg>
</h1><!--Original svg: https://www.svgrepo.com/svg/183077/thread-->
    
    <p>Simply type your whole thread in the text field, then select the snippets one at a time and copy them.<br>Use <i class="marked">"#!cut!"</i> to insert a cut at a specific point.<br><a href="#aboutThis">about this tool</a></p>
    <div class="container">
        <textarea id="inputText" class="inputArea" rows="10">Enter your text here!</textarea>
        <label for="maxCharCount">Max Characters per Part:</label>
        <input type="number" id="maxCharCount" value="250" min="0" class="number">
        <label for="snippetSelector">Snippet:</label>
        <select id="snippetSelector">
            <option value="wholeText">Whole text</option>
        </select>
        <button id="copyButton">Copy snippet to clipboard</button>
        <div class="outputcontainer">
            <textarea id="snippetOutput" rows="10" disabled></textarea>
        </div>
    </div>
    <div id="aboutThis">
        <h2>About this tool</h2>
        <p>This tool is run only on your device, no data is sent to any server. Feel free to check and use the source code on <a href="https://github.com/linuscon/threadSplit" target="_blank" class="marked">github</a>.
    </div>

    <script>
        const inputText = document.getElementById("inputText");
        const snippetSelector = document.getElementById("snippetSelector");
        const snippetOutput = document.getElementById("snippetOutput");
        const copyButton = document.getElementById("copyButton");
        const maxCharCount = document.getElementById("maxCharCount");

        inputText.addEventListener("input", updateSnippetArr);
        snippetSelector.addEventListener("change", updateSnippet);
        copyButton.addEventListener("click", copySnippet);
        maxCharCount.addEventListener("input", maxCharCountChanged);

        var snippets = new Array();
        
        updateSnippet();

        // Updates the snippet
        function updateSnippet() {
            //if selected snippet is whole text or empty, set the whole text
            if (snippetSelector.selectedIndex === 0 || snippetSelector.length === 0) {
                copyButton.innerHTML = "Copy whole text to clipboard";
                text = inputText.value;
                //if there is a \n after a #!cut!, remove it
                text = text.replace(/#!cut!\n/g, "#!cut!");
                //cut every #!cut! from the text and replace it with a line break
                text = text.replace(/#!cut!/g, "\n");
                snippetOutput.innerHTML = text;
            } else {
                copyButton.innerHTML = "Copy snippet to clipboard";
                snippetOutput.innerHTML = snippets[snippetSelector.selectedIndex-1];
            }
        }

        function updateSnippetSelector(){
            //clear the selector
            snippetSelector.innerHTML = "";
            //add the whole text option
            let option = document.createElement("option");
            option.text = "Whole text";
            snippetSelector.add(option);
            //add the other options
            for(let i = 0; i<snippets.length; i++){
                option = document.createElement("option");
                option.text = "Snippet " + (i+1);
                snippetSelector.add(option);
            }
        }
        function maxCharCountChanged(){
            updateSnippetArr();
        }
        
        //following function is inspired/borrowed from https://www.w3schools.com/howto/howto_js_copy_clipboard.asp
        // Copies the snippet to the clipboard
        function copySnippet() {
            // Get the text field
            var copyText = snippetOutput;

            //query permission to access the clipboard
            navigator.permissions.query({ name: "clipboard-write" }).then((result) => {
            if (result.state === "granted" || result.state === "prompt") {
                // Write to the clipboard
                navigator.clipboard.writeText(copyText.value).then(function() {
                /* clipboard successfully set */
                }, function() {
                    /* clipboard write failed */
                    alert("Failed to copy to clipboard! Please select the text manually and copy it!");
                });
            }
            });
        }

        // Updates the snippet array
        function updateSnippetArr(){
            if(maxCharCount.value <= 0){
                maxCharCount.value = 1;
            }
            if(inputText.value.length <= 0){
                return;
            }
            //clear the array
            snippets = [];
            //split the text into parts with maxCharCount characters or if encountering #!cut
            let text = inputText.value;
            let part = "";
            let charCount = 0;
            for(let i = 0; i<text.length; i++){
                if(text.substring(i, i+6) === "#!cut!"){
                    snippets.push(part);
                    part = "";
                    charCount = 0;
                    i+=5;
                    //if the next character is a line break, skip it
                    if(text[i+1] === "\n"){
                        i++;
                    }
                } else {
                    part += text[i];
                    charCount++;
                    if(charCount > maxCharCount.value){
                        snippets.push(part);
                        part = "";
                        charCount = 0;
                    }
                }
            }
            //add the last part
            if(part.length > 0){
                snippets.push(part);
            }
            //update the snippet selector
            updateSnippetSelector();
            //update the snippet
            updateSnippet();
        }
    </script>
</body>
</html>